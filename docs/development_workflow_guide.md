# Development Workflow Guide

Last updated: 2026-02-25

## 1) Canonical Working Docs
- Primary handoff: `docs/codex_handoff_20260225.md`
- Legacy snapshots: `docs/dev_history/handoffs/codex_handoff_20260224.md`, `docs/dev_history/handoffs/codex_handoff_20260223.md`, `docs/dev_history/handoffs/codex_handoff_20260222.md`, `docs/dev_history/handoffs/codex_handoff_20260220.md`
- History index: `docs/dev_history/README.md`
- Strategy docs:
- `docs/run_site_publish_strategy.md`
- `docs/ppt_writer_strategy.md`
- `docs/federhav_deepagent_transition_plan.md`
- `docs/future_architecture_plan.md`
- `docs/report_quality_threshold_policy.md`
- `docs/codex_resume_guide.md`

## 2) Iter Execution Rule
- Work in `iter` units.
- For each iter:
- define target scope -> implement -> test -> update handoff(progress + timestamp) -> commit/push at iter end
- Default: do not commit in the middle of an iter batch.
- Exception: commit mid-iter only when explicitly requested by user.
- 5 iter마다 handoff에 진행률/리스크/검증 로그를 업데이트한다.
- 20 iter마다 샘플 보고서 생성 및 품질 게이트를 실행한다.

## 2.1) Report Quality Gate Rule (Mandatory)
- Quality gate는 반드시 **해당 iter 배치에서 새로 생성한 보고서**를 입력으로 측정한다.
- 과거 보고서 재측정은 회귀 점검에만 사용하고, 품질 상승 근거로 단독 사용하지 않는다.
- gate 실행 기록에는 다음을 함께 남긴다:
- 생성 보고서 경로
- 사용한 프롬프트/독자 톤
- gate 결과 md/json 경로
- 수기 리뷰 요약(장문 밀도/근거 추적/시각화 품질)

## 3) Temporary Output Policy
- Create temporary/debug artifacts only under `temp/`.
- Recommended layout:
- `temp/<yyyyMMdd>/<topic>/...`
- Do not create root-level temp files.
- Test audit artifacts are stored only under `test-results/` (no extra root folders).
- Root-level transient directories are limited to:
- `temp/` (ephemeral debug/log)
- `test-results/` (iter test evidence)
- `node_modules/` (npm install output, recreate-on-demand)
- `artifacts/` (optional packaging/debug output, recreate-on-demand)
- Ignored temp patterns are in `.gitignore`.
- Safe local cleanup (without touching tracked sources):
- `cmd /c if exist node_modules rmdir /s /q node_modules`
- `cmd /c if exist artifacts rmdir /s /q artifacts`
- `cmd /c if exist temp rmdir /s /q temp`

## 4) Folder Purpose (Current)
- `tests/`: unit/integration/regression tests.
- `test-results/`: test/audit artifacts (json, png, reports) generated by runs.
- `artifacts/`: build/analysis outputs for packaging or automation pipelines.
- `image/`: repository-level image assets (historical snapshots/changelog captures).
- `node_modules/`: frontend JS dependencies installed by npm.
- `tools/`: operational scripts (benchmarking, gates, utilities, recovery scripts).
- `docs/`: development guides, handoff, roadmap, policy, and strategy docs.

## 5) Repo Hygiene Checklist
- Before commit:
- `git status --short`
- confirm no accidental temp/debug files
- ensure handoff has updated progress/time
- validate key tests used in iter
- if version changed, run `python tools/check_version_consistency.py` and ensure `README.md` + `CHANGELOG.md` + `pyproject.toml` + `src/federlicht/versioning.py` are aligned
- After push:
- verify branch tip and clean working tree

## 6) LLM Default Policy (Cloud vs On-Prem)
- Deployment mode is auto-detected from `OPENAI_BASE_URL` / `OPENAI_API_BASE`.
- Rule:
- if host is `api.openai.com` or env is empty -> `openai_cloud`
- if host is custom (for example local/vllm/sglang/ollama gateway) -> `on_prem`
- OpenAI cloud defaults:
- federlicht writer/check/feather default model: `gpt-5-nano`
- federhav default model: `gpt-4o-mini`
- On-prem defaults:
- planner / federhav: `Qwen3-235B-A22B-Thinking-2507`
- feather executor(agentic search): `Qwen3-Coder-480B-A35B-Instruct`
- federlicht writer: `Qwen3-235B-A22B-Instruct-2507`
- vision: `Llama-4-Scout`
- Explicit env overrides always win:
- `OPENAI_MODEL`
- `OPENAI_MODEL_VISION`
- `FEDERHAV_MODEL`
- `FEATHER_AGENTIC_MODEL`
- `FEDERLICHT_CHECK_MODEL`

## 7) CDN/Offline Asset Policy
- MathJax/Mermaid runtime script loading uses local-first fallback chain.
- Local vendor paths:
- `site/federnett/vendor/mathjax/tex-svg.js`
- `site/federnett/vendor/mermaid/mermaid.min.js`
- Loader order:
- local absolute/relative paths first
- CDN (`jsdelivr` / `cdnjs`) last
- 운영 권장:
- on-prem 배포에서는 vendor 파일을 저장소에 포함하고, 외부 CDN 접근을 필수 경로로 가정하지 않는다.
- vendor 자산 동기화:
- `powershell -ExecutionPolicy Bypass -File tools/sync_web_vendor_assets.ps1`
- 네트워크 격리 환경에서 first paint 지연이 크면 report_hub의 외부 font CDN(`fonts.googleapis.com`)도 로컬 번들/시스템 폰트로 전환한다.
