<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Federnett</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600;700&family=Manrope:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;600&family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./app.css?v=20260222_uiux_v50" />
  </head>
  <body>
    <div class="app">
      <section class="brand-showcase">
        <div class="brand-floating">
          <img
            class="brand-logo-floating"
            src="/api/raw?path=src/federnett/logo.png"
            alt="Federnett logo"
          />
        </div>
        <div class="showcase-copy">
          <h1>Enlighten Your Technology Insight.</h1>
          <p>
            Collect evidence with Feather, synthesize with Federlicht, and keep every
            <span class="no-wrap">decision auditable inside your repo.</span>
          </p>
          <div class="meta-strip" id="meta-strip"></div>
        </div>
      </section>
      <header class="topbar">
        <div class="brand">
          <span class="brand-dot" aria-hidden="true"></span>
          <div class="brand-text">
            <div class="brand-title-row">
              <strong>Federnett</strong>
              <span class="brand-kicker">Agentic Research Studio</span>
            </div>
            <span>Feather + Federlicht Studio</span>
          </div>
        </div>
        <div class="top-actions">
          <div class="top-actions-main">
            <button id="workspace-run-folder" class="ghost">Run Folder 설정</button>
            <button id="workspace-model-settings" class="ghost">LLM Settings</button>
            <button id="workspace-open-settings" class="ghost">Agent Workspace Settings</button>
            <button id="workflow-studio-toggle-global" class="ghost">Workflow Studio</button>
          </div>
          <div class="top-actions-side">
            <button id="help-button" class="ghost">Help</button>
            <label class="theme-select">
              <span>Theme</span>
              <select id="theme-select" aria-label="Theme">
                <option value="white">White</option>
                <option value="black">Black</option>
                <option value="sky">Sky</option>
                <option value="crimson">Crimson</option>
                <option value="sage">Sage</option>
                <option value="amber">Amber</option>
              </select>
            </label>
          </div>
        </div>
      </header>

      <section class="ask-panel" id="ask-panel" aria-hidden="true">
          <div class="ask-panel-head">
            <div>
            <h2>FederHav 고급 콘솔</h2>
            <p>레거시 확장 패널입니다. 기본 작업은 Live Logs 타임라인에서 진행하세요.</p>
            </div>
            <div class="ask-panel-actions">
              <div class="ask-thread-inline">
                <button type="button" id="ask-thread-toggle" class="ghost">대화 스레드</button>
              </div>
              <small class="muted">LLM backend/model/reasoning은 상단 <strong>LLM Settings</strong>에서 Global+스코프 정책으로 관리됩니다.</small>
              <button type="button" id="ask-open-llm-settings" class="ghost">LLM Settings</button>
              <button type="button" id="ask-geometry-reset" class="ghost">위치 초기화</button>
              <button type="button" id="ask-reset" class="ghost">Reset</button>
              <button type="button" id="ask-close" class="ghost">접기</button>
            </div>
          </div>
        <div class="ask-thread-popover" id="ask-thread-popover" aria-hidden="true">
          <div class="ask-threads-head">
            <h3>대화 스레드</h3>
            <div class="ask-threads-actions">
              <button type="button" id="ask-thread-new" class="ghost mini">새로 만들기</button>
              <button type="button" id="ask-thread-delete" class="ghost mini">삭제</button>
            </div>
          </div>
          <div id="ask-thread-list" class="ask-thread-list"></div>
        </div>
        <div class="ask-main-scroll">
          <div class="ask-status" id="ask-status">Ready.</div>
          <div class="ask-results">
            <article class="ask-answer-wrap">
              <div class="ask-pane-head">
                <h3>대화</h3>
                <button type="button" id="ask-jump-latest" class="ghost mini" title="최신 대화로 이동">최신으로</button>
              </div>
              <div id="ask-answer" class="ask-answer"></div>
            </article>
            <aside class="ask-right-wrap">
              <section class="ask-trace-wrap">
                <div class="ask-pane-head">
                  <h3>Agent 실행 추적</h3>
                  <button type="button" id="ask-trace-toggle" class="ghost mini">이력 보기</button>
                </div>
                <div class="ask-sources-trace" id="ask-sources-trace">
                  <div id="ask-sources-cap-grid" class="ask-sources-cap-grid"></div>
                </div>
              </section>
            </aside>
          </div>
        </div>
        <div class="ask-form-dock">
          <div class="ask-form-row">
            <label class="ask-question-field">
              <div class="ask-question-head">
                <span>질문</span>
                <div id="ask-history" class="ask-history"></div>
              </div>
              <textarea
                id="ask-input"
                rows="2"
                placeholder="예: Feather에서 Agentic Search를 언제 켜야 하나요?"
              ></textarea>
            </label>
            <div class="ask-submit-column">
              <div class="ask-policy-row ask-policy-row-inline">
                <div class="ask-policy-field ask-mode-field">
                  <input type="hidden" id="ask-action-mode" value="plan" />
                  <div class="ask-mode-switch" id="ask-action-mode-switch" role="group" aria-label="Action mode">
                    <button type="button" class="ghost mini is-on" data-ask-mode="plan">Plan</button>
                    <button type="button" class="ghost mini" data-ask-mode="act">Act</button>
                  </div>
                  <small id="ask-action-mode-hint">Plan: FederHav 제안 후 확인 실행</small>
                </div>
                <label class="ask-policy-check is-hidden" id="ask-artifact-policy">
                  <input type="checkbox" id="ask-allow-artifacts" />
                  <span>파일쓰기허용</span>
                </label>
              </div>
              <button type="button" id="ask-run" class="primary ask-run">
                <span>질문 실행</span>
                <small>Ctrl+Enter</small>
              </button>
            </div>
          </div>
        </div>
      </section>

      <main class="layout">
        <section class="panel control" id="control-panel">
          <div class="control-collapse-rail">
            <span class="control-rail-title">Workspace Sidebar</span>
            <button type="button" id="control-panel-toggle" class="ghost mini" title="사이드바 닫기">닫기</button>
          </div>
          <div class="control-collapsed-actions" aria-hidden="true">
            <button type="button" class="ghost mini" id="control-collapsed-open-feather">Feather</button>
            <button type="button" class="ghost mini" id="control-collapsed-open-federlicht">Federlicht</button>
            <button type="button" class="ghost mini" id="control-collapsed-open-runstudio">Run Studio</button>
          </div>
          <div class="tabs-row">
            <div class="tabs" role="tablist">
              <button
                class="tab active"
                data-tab="feather"
                role="tab"
                aria-selected="true"
              >
                Feather
              </button>
              <button class="tab" data-tab="federlicht" role="tab">
                Federlicht
              </button>
              <button class="tab" data-tab="runstudio" role="tab">
                Run Studio
              </button>
            </div>
            <div class="quick-run-row" role="group" aria-label="Quick run actions">
              <button type="button" class="primary quick-run-button" id="quick-run-feather">
                Run Feather
              </button>
              <button type="button" class="primary quick-run-button" id="quick-run-federlicht">
                Run Federlicht
              </button>
            </div>
          </div>
          <div class="tab-guide" id="tab-guide" aria-live="polite">
            <strong>1단계 Feather</strong>
            <span>외부 자료 수집과 증거 아카이빙</span>
          </div>
          <div class="sidebar-run-context" id="sidebar-run-context">
            <small id="sidebar-run-context-text" class="muted">workspace: - · report hub: - · run folder: -</small>
            <button type="button" id="sidebar-open-run-folder" class="ghost mini">Run Folder 설정</button>
          </div>

          <section class="tab-panel active" id="tab-feather" role="tabpanel">
            <div class="tab-shell">
              <form id="feather-form" class="form-grid">
                <label class="run-folder-inline">
                  <span>Run Folder (selected)</span>
                  <input id="feather-run-name" name="run_name" type="hidden" />
                  <input
                    id="feather-output"
                    name="output"
                    class="readonly-field"
                    placeholder="Choose Run Folder"
                    readonly
                    required
                  />
                  <small id="feather-output-hint" class="field-path-hint muted">Run Folder에서 선택한 대상 run을 사용합니다.</small>
                </label>

                <label class="wide run-folder-inline">
                  <span>Run Folder Control</span>
                  <button type="button" id="feather-open-run-folder" class="ghost">
                    Choose Run Folder
                  </button>
                  <small class="muted">Run Name/Folder는 상단 <code>Run Folder 설정</code> 패널에서만 변경됩니다.</small>
                </label>

                <label class="wide">
                  <span>Instruction File</span>
                  <div class="combo">
                    <input
                      id="feather-input"
                      name="input"
                      placeholder="20260127_new-run/instruction/20260127_new-run.txt"
                    />
                    <button type="button" id="feather-pick-instruction" class="ghost">
                      Choose
                    </button>
                  </div>
                </label>

                <label class="wide">
                  <span>Instruction (editable)</span>
                  <textarea
                    id="feather-query"
                    name="query"
                    rows="4"
                    placeholder="Edit or draft the instruction content here. Save to a file or run as ad-hoc query."
                  ></textarea>
                </label>
                <div class="instruction-inline-actions wide">
                  <button type="button" id="feather-save-instruction" class="ghost">
                    Save Instruction
                  </button>
                  <button type="button" id="feather-saveas-instruction" class="ghost">
                    Save Instruction As
                  </button>
                </div>

                <div class="toggles wide">
                  <label class="toggle">
                    <input type="checkbox" id="feather-download-pdf" checked />
                    <span>Download PDFs</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-openalex" checked />
                    <span>OpenAlex</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-youtube" />
                    <span>YouTube</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-yt-transcript" />
                    <span>YT Transcript</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-update-run" checked />
                    <span>Reuse Run Folder</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="feather-agentic-search" />
                    <span>Agentic Search</span>
                  </label>
                </div>

                <section class="wide options-panel" aria-label="Feather execution options">
                  <div class="options-title-row">
                    <strong>Execution Options</strong>
                    <small id="feather-agentic-policy-note" class="muted">
                      Agentic Search 모델 정책은 상단 LLM Settings의 Feather 정책을 사용합니다.
                    </small>
                  </div>
                  <div class="advanced-grid">
                    <label>
                      <span>Language</span>
                      <select id="feather-lang">
                        <option value="en" selected>en</option>
                        <option value="ko">ko</option>
                        <option value="de">de</option>
                      </select>
                    </label>
                    <label>
                      <span>Days</span>
                      <input id="feather-days" type="number" min="1" value="365" />
                    </label>
                    <label>
                      <span>Max Results</span>
                      <input
                        id="feather-max-results"
                        type="number"
                        min="1"
                        value="8"
                      />
                    </label>
                    <label>
                      <span>YouTube Order</span>
                      <input id="feather-yt-order" placeholder="relevance" />
                    </label>
                    <label class="wide">
                      <span>Extra Args</span>
                      <input
                        id="feather-extra-args"
                        placeholder="--tavily-topic news --max-openalex-pdfs 12"
                      />
                    </label>
                    <label>
                      <span>Agentic Max Iter</span>
                      <input id="feather-max-iter" type="number" min="1" value="3" />
                    </label>
                  </div>
                </section>

              </form>
            </div>
          </section>

          <section class="tab-panel" id="tab-federlicht" role="tabpanel">
            <div class="tab-shell">
              <form id="federlicht-form" class="form-grid">
                <label class="wide run-folder-inline">
                  <span>Run Folder</span>
                  <div class="combo combo-run-folder">
                    <input
                      id="federlicht-run-display"
                      class="readonly-field"
                      placeholder="Choose Run Folder"
                      readonly
                    />
                    <button type="button" id="federlicht-open-run-folder" class="ghost">
                      Choose Run Folder
                    </button>
                  </div>
                  <select id="run-select" hidden aria-hidden="true" tabindex="-1"></select>
                  <small id="federlicht-run-hint" class="field-path-hint muted">선택된 run: -</small>
                </label>

                <label class="wide">
                  <span>Output Report</span>
                  <input
                    id="federlicht-output"
                    placeholder="report_full.html"
                    required
                  />
                  <small id="federlicht-output-hint" class="muted"
                    >선택된 run 폴더 아래에 저장됩니다. 동일 파일이 있으면 자동으로 <code>_1</code>, <code>_2</code>가 붙습니다.</small
                  >
                </label>

                <label>
                  <span>Template</span>
                  <select id="template-select"></select>
                </label>

                <label>
                  <span>Style Pack</span>
                  <select id="federlicht-style-pack">
                    <option value="none" selected>None</option>
                    <option value="dark">Dark</option>
                    <option value="journal">Journal</option>
                    <option value="magazine">Magazine</option>
                  </select>
                </label>

                <label>
                  <span>Language</span>
                  <select id="federlicht-lang">
                    <option value="ko" selected>ko</option>
                    <option value="en">en</option>
                    <option value="de">de</option>
                  </select>
                </label>

                <label>
                  <span>Depth</span>
                  <select id="federlicht-depth">
                    <option value="brief">brief</option>
                    <option value="standard" selected>standard</option>
                    <option value="deep">deep</option>
                    <option value="extreme">extreme</option>
                  </select>
                </label>
                <div class="runtime-summary-panel wide">
                  <div class="runtime-summary-head">
                    <strong>Runtime Model Policy</strong>
                    <span id="federlicht-runtime-gateway" class="runtime-summary-pill">gateway: -</span>
                  </div>
                  <div id="federlicht-runtime-summary" class="runtime-summary-chips"></div>
                  <p id="federlicht-runtime-notes" class="runtime-summary-notes muted">
                    실행 전에 backend/model/check/reasoning 자동 조정 결과를 확인하세요.
                  </p>
                </div>
                <div class="profile-summary-panel">
                  <span class="profile-summary-label">Active Agent Profile</span>
                  <div id="federlicht-profile-summary" class="profile-summary-value">-</div>
                </div>

                <label class="wide">
                  <span>Prompt File</span>
                  <div class="combo">
                    <input
                      id="federlicht-prompt-file"
                      placeholder="20260127_new-run/instruction/generated_prompt_20260127_new-run.txt"
                    />
                    <div class="combo-actions">
                      <button type="button" id="federlicht-prompt-pick" class="ghost">
                        Choose
                      </button>
                      <button type="button" id="federlicht-prompt-generate" class="ghost">
                        Generate Prompt
                      </button>
                    </div>
                  </div>
                  <small id="federlicht-prompt-file-hint" class="field-path-hint muted">프롬프트 파일: -</small>
                </label>

                <label class="wide">
                  <span>Inline Prompt</span>
                  <textarea
                    id="federlicht-prompt"
                    rows="4"
                    placeholder="Optional: override or extend the prompt."
                  ></textarea>
                </label>
                <div class="instruction-inline-actions wide">
                  <button type="button" id="federlicht-save-prompt" class="ghost">
                    Save Prompt
                  </button>
                  <button type="button" id="federlicht-prompt-expand" class="ghost">
                    Expand Prompt
                  </button>
                  <button type="button" id="federlicht-saveas-prompt" class="ghost">
                    Save Prompt As
                  </button>
                </div>

                <div class="toggles wide">
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-figures" checked />
                    <span>Figures</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-web-search" />
                    <span>Web Search</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-free-format" />
                    <span>Free Format <span class="muted">(No Template)</span></span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="federlicht-no-tags" />
                    <span>No Tags <span class="muted">(default off)</span></span>
                  </label>
                </div>

                <section class="wide options-panel" aria-label="Federlicht execution options">
                  <div class="options-title-row">
                    <strong>Execution Options</strong>
                    <small class="muted">LLM 정책은 상단 LLM Settings의 Federlicht 정책을 사용합니다.</small>
                  </div>
                  <div class="advanced-grid">
                    <label>
                      <span>Template Rigidity</span>
                      <select id="federlicht-template-rigidity">
                        <option value="strict">strict</option>
                        <option value="balanced" selected>balanced</option>
                        <option value="relaxed">relaxed</option>
                        <option value="loose">loose</option>
                        <option value="off">off</option>
                      </select>
                    </label>
                    <label>
                      <span>Temperature Level</span>
                      <select id="federlicht-temperature-level">
                        <option value="very_low">very_low (0.0)</option>
                        <option value="low">low (0.1)</option>
                        <option value="balanced" selected>balanced (0.2)</option>
                        <option value="high">high (0.4)</option>
                        <option value="very_high">very_high (0.7)</option>
                      </select>
                    </label>
                    <input id="federlicht-stages" type="hidden" value="scout,evidence,plan,writer,quality" />
                    <input id="federlicht-skip-stages" type="hidden" value="" />
                    <input id="federlicht-quality-iterations" type="hidden" value="1" />
                    <input id="federlicht-agent-config" type="hidden" value="" />
                    <label>
                      <span>Quality Strategy</span>
                      <input id="federlicht-quality-strategy" value="pairwise" />
                    </label>
                    <label>
                      <span>Figures Mode</span>
                      <input id="federlicht-figures-mode" value="auto" />
                    </label>
                    <label>
                      <span>Figures Select</span>
                      <input
                        id="federlicht-figures-select"
                        placeholder="report_notes/figures_selected.txt"
                      />
                    </label>
                    <label class="wide">
                      <span>Tags</span>
                      <input id="federlicht-tags" placeholder="qc,oled,materials" />
                    </label>
                    <label class="wide">
                      <span>Site Output</span>
                      <input id="federlicht-site-output" placeholder="site/report_hub" />
                    </label>
                    <label class="wide">
                      <span>Extra Args</span>
                      <input
                        id="federlicht-extra-args"
                        placeholder="--progress --stream --repair-debug"
                      />
                    </label>
                  </div>
                </section>

              </form>
            </div>
          </section>

          <section id="run-studio-wrap" class="tab-panel" role="tabpanel" aria-live="polite">
            <div class="tab-shell runstudio-shell">
              <div class="runstudio-meta-head">
                <p id="studio-meta">Pick a run to inspect evidence, review artifacts, and shape the pipeline.</p>
                <div class="panel-pills">
                  <span class="meta-pill" id="studio-run-rel">-</span>
                  <span class="meta-pill" id="studio-updated">-</span>
                </div>
              </div>

              <div class="studio-grid">
                <section class="studio-card summary-card" id="run-files-card">
                  <header>
                    <h3>Run Snapshot &amp; Files</h3>
                    <p>Coverage summary and quick file access for the selected run.</p>
                  </header>
                  <div class="summary-actions">
                    <button id="run-publish-hub" class="ghost" type="button" disabled>
                      Publish to Report Hub
                    </button>
                    <button id="run-trash" class="danger" type="button" disabled>
                      Trash Run
                    </button>
                  </div>
                  <div id="run-summary-lines" class="summary-lines"></div>
                  <div id="run-summary-links" class="summary-links"></div>
                  <div id="run-summary-reports" class="summary-reports"></div>
                  <div id="run-figure-tools" class="run-figure-tools is-empty"></div>
                  <section class="run-hub-panel" id="run-hub-panel" aria-live="polite">
                    <div class="run-hub-head">
                      <strong>Report Hub Collaboration</strong>
                      <div class="run-hub-head-actions">
                        <span class="meta-pill" id="run-hub-status">unlinked</span>
                        <button id="run-hub-refresh" class="ghost mini" type="button">Refresh</button>
                      </div>
                    </div>
                    <p id="run-hub-context" class="muted">Run과 연결된 Hub 게시글을 확인하는 중...</p>
                    <div id="run-hub-link" class="run-hub-link muted">Hub link: -</div>
                    <div class="run-hub-approval-row">
                      <label>
                        <span>Approval</span>
                        <select id="run-hub-approval-status" aria-label="Report Hub approval status">
                          <option value="draft">draft</option>
                          <option value="review">review</option>
                          <option value="approved">approved</option>
                          <option value="published">published</option>
                          <option value="rejected">rejected</option>
                          <option value="archived">archived</option>
                        </select>
                      </label>
                      <label class="wide">
                        <span>Approval note</span>
                        <input id="run-hub-approval-note" type="text" placeholder="검토 메모/사유" aria-label="Report Hub approval note" />
                      </label>
                      <button id="run-hub-approval-save" class="ghost mini" type="button">Save Approval</button>
                    </div>
                    <div id="run-hub-approval-hint" class="run-hub-approval-hint muted">
                      허용 전이 상태를 동기화하는 중입니다.
                    </div>
                    <div class="run-hub-compose-grid">
                      <label class="wide">
                        <span>Comment</span>
                        <textarea
                          id="run-hub-comment-input"
                          rows="2"
                          placeholder="게시글 코멘트/리뷰 의견을 남깁니다."
                          aria-label="Report Hub comment"
                        ></textarea>
                      </label>
                      <button id="run-hub-comment-submit" class="ghost mini" type="button">Add Comment</button>
                      <label class="wide">
                        <span>Follow-up task</span>
                        <textarea
                          id="run-hub-followup-input"
                          rows="2"
                          placeholder="다음 리비전 액션/요청 프롬프트를 기록합니다."
                          aria-label="Report Hub follow-up task"
                        ></textarea>
                      </label>
                      <button id="run-hub-followup-submit" class="ghost mini" type="button">Add Follow-up</button>
                      <button id="run-hub-link-submit" class="ghost mini" type="button">Link Current Run</button>
                    </div>
                    <div id="run-hub-timeline" class="run-hub-timeline"></div>
                  </section>
                  <section class="run-metrics-panel" id="run-metrics-panel" aria-live="polite">
                    <div class="run-metrics-head">
                      <strong>Stage Cost/Time Dashboard</strong>
                      <span class="muted" id="run-metrics-summary">No metrics yet.</span>
                    </div>
                    <div id="run-metrics-body" class="run-metrics-body"></div>
                  </section>
                  <div class="file-list" id="run-file-list"></div>
                </section>
              </div>
            </div>
          </section>
        </section>
        <section class="panel telemetry" id="logs-wrap">
          <div class="telemetry-grid">
            <section class="telemetry-block logs-block">
              <div class="panel-head slim">
                <div>
                  <h2>Live Logs</h2>
                  <p id="job-status">No active job.</p>
                </div>
                <div class="log-actions">
                  <span class="meta-pill" id="recent-jobs-count">0</span>
                  <span class="muted" id="recent-jobs-last">No recent jobs.</span>
                  <button type="button" id="jobs-open" class="ghost mini">최근 이력</button>
                  <button id="log-maximize" class="ghost">최대화</button>
                  <button id="log-clear" class="ghost">Clear</button>
                  <button id="job-kill" class="danger" disabled>Stop</button>
                </div>
              </div>
              <section class="live-ask-dock" id="live-ask-dock" aria-label="Live Logs 질문 패널">
                <div class="live-ask-main">
                  <div class="live-ask-thread-wrap">
                    <div id="live-ask-thread" class="live-ask-thread is-empty" aria-live="polite">
                      아직 대화가 없습니다. Live Logs/결과를 바탕으로 질문해보세요.
                    </div>
                    <button type="button" id="live-ask-jump-latest" class="ghost mini is-hidden">최신으로 이동</button>
                  </div>
                  <div class="live-ask-composer">
                    <div class="live-ask-row">
                      <label class="live-ask-input-wrap">
                        <span id="live-ask-label">Ask FederHav</span>
                        <textarea
                          id="live-ask-input"
                          rows="3"
                          placeholder="질문/작업 요청을 입력하세요. Enter 실행, Shift+Enter 줄바꿈."
                        ></textarea>
                        <div class="live-ask-input-foot">
                          <small id="live-ask-input-meta" class="muted">0자 · Enter 실행 · Shift+Enter 줄바꿈</small>
                          <small id="live-ask-status" class="muted"></small>
                          <label class="ask-policy-check is-hidden" id="live-ask-artifact-policy">
                            <input type="checkbox" id="live-ask-allow-artifacts" />
                            <span>파일쓰기</span>
                          </label>
                        </div>
                      </label>
                      <div class="live-ask-side-actions">
                        <button type="button" id="live-ask-run" class="primary ask-run live-ask-toggle" aria-label="질문 실행">
                          <span class="ask-run-icon" aria-hidden="true">➤</span>
                          <span class="ask-run-spinner" aria-hidden="true"></span>
                        </button>
                        <div class="ask-mode-switch ask-mode-switch-vertical" id="live-ask-mode-switch" role="group" aria-label="Live ask action mode">
                          <button type="button" class="ghost mini is-on" data-ask-mode="plan">Plan</button>
                          <button type="button" class="ghost mini" data-ask-mode="act">Act</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="workflow-strip workflow-in-dock" id="workflow-strip">
                    <div class="workflow-head">
                      <strong>Workflow Pipeline</strong>
                      <div class="workflow-head-actions">
                        <span id="workflow-status">Idle</span>
                      </div>
                    </div>
                    <div class="workflow-track" id="workflow-track" aria-live="polite"></div>
                    <div class="workflow-runtime" id="workflow-runtime" aria-live="polite"></div>
                    <details class="workflow-ops-wrap" id="workflow-ops-wrap">
                      <summary>Resume &amp; Action Tools</summary>
                      <div class="workflow-ops-body">
                        <div class="workflow-history-controls" id="workflow-history-controls">
                          <span id="workflow-history-hint" class="muted">History checkpoint: -</span>
                          <div class="workflow-history-actions">
                            <button
                              type="button"
                              id="workflow-resume-apply"
                              class="ghost"
                              title="선택한 단계부터 재실행 프리셋을 만듭니다."
                              disabled
                            >
                              Resume from stage
                            </button>
                            <button
                              type="button"
                              id="workflow-resume-prompt"
                              class="ghost"
                              title="재실행용 update prompt 초안을 instruction 폴더에 생성합니다."
                              disabled
                            >
                              Draft update prompt
                            </button>
                            <div class="workflow-help-wrap">
                              <button
                                type="button"
                                id="workflow-resume-help"
                                class="ghost workflow-help-trigger"
                                aria-label="Resume 도움말"
                              >
                                ?
                              </button>
                              <div class="workflow-help-popover" role="tooltip">
                                <strong>Resume 동작 방식</strong>
                                <ol>
                                  <li>파이프라인에서 재시작할 에이전트 단계를 클릭합니다.</li>
                                  <li><code>Resume from ...</code> 버튼으로 실행 단계를 해당 위치부터로 맞춥니다.</li>
                                  <li><code>Draft update prompt</code>로 수정요청 파일 생성 후 Inline Prompt에 자동 로드합니다.</li>
                                </ol>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="workflow-resume-guide is-empty" id="workflow-resume-guide" aria-live="polite"></div>
                        <div class="workflow-extras is-empty" id="workflow-extras" aria-live="polite"></div>
                      </div>
                    </details>
                  </div>
                </div>
              </section>
            </section>

            <aside
              class="workflow-studio-panel"
              id="workflow-studio-panel"
              aria-hidden="true"
              aria-label="Workflow Studio side panel"
            >
              <header class="workflow-studio-head">
                <div>
                  <h3>Workflow Studio</h3>
                  <p>Feather/Federlicht 단계를 선택해 설정하고 바로 실행합니다.</p>
                </div>
                <button type="button" id="workflow-studio-close" class="ghost mini">접기</button>
              </header>
              <div class="workflow-studio-stagebar">
                <strong id="stage-detail-title">Workflow Studio</strong>
                <button type="button" id="pipeline-help" class="ghost mini">도움말</button>
              </div>
              <div class="workflow-studio-scroll">
                <section class="workflow-studio-section">
                  <h4>Pipeline 선택</h4>
                  <div class="pipeline-chips" id="pipeline-chips"></div>
                  <div class="pipeline-meta workflow-studio-meta">
                    <div>stages: <code id="pipeline-stages-value">-</code></div>
                    <div>skip_stages: <code id="pipeline-skip-value">-</code></div>
                  </div>
                  <div class="workflow-studio-grid">
                    <label>
                      <span>Quality Iterations</span>
                      <select id="wf-quality-iterations" aria-label="Quality iteration passes">
                        <option value="1">x1</option>
                        <option value="2">x2</option>
                        <option value="3">x3</option>
                        <option value="4">x4</option>
                        <option value="5">x5</option>
                        <option value="6">x6</option>
                        <option value="7">x7</option>
                        <option value="8">x8</option>
                        <option value="9">x9</option>
                        <option value="10">x10</option>
                      </select>
                      <small class="workflow-studio-field-help">Quality stage의 critic/reviser/evaluator 반복 횟수입니다.</small>
                    </label>
                  </div>
                  <p class="workflow-studio-note">
                    선택된 단계만 실행됩니다. `skip_stages`는 비활성화된 단계를 자동 계산해 표시합니다.
                  </p>
                </section>

                <section class="workflow-studio-section">
                  <h4>고급 Stage 설정</h4>
                  <p class="workflow-studio-note">
                    Stage override 편집은 상단 <strong>LLM Settings</strong>에서 관리됩니다.
                  </p>
                </section>

                <section class="workflow-studio-section">
                  <h4>FederHav Bridge</h4>
                  <p class="workflow-studio-note">
                    FederHav는 User와 Orchestrator 사이에서 의도를 해석하고, Executor subagent를 통해
                    Feather/Federlicht/단계별 agent 작업으로 전달합니다.
                  </p>
                </section>
              </div>
              <footer class="workflow-studio-actions">
                <button type="button" id="workflow-run-resume" class="ghost">선택 단계부터</button>
                <button type="button" id="workflow-run-feather" class="ghost">Run Feather</button>
                <button type="button" id="workflow-run-federlicht" class="ghost">Run Federlicht</button>
                <button type="button" id="workflow-run-all" class="primary">Run Workflow</button>
              </footer>
            </aside>

            <div
              id="telemetry-splitter"
              class="splitter-vertical"
              aria-hidden="true"
              title="Drag to resize logs"
            ></div>

            <section class="telemetry-block preview-block is-open" id="preview-popup" aria-hidden="false" tabindex="-1">
              <div class="panel-head slim preview-popup-head" id="preview-popup-head">
                <div>
                  <h2>File Preview</h2>
                  <p>Preview reports, markdown, PDFs, or edit text files.</p>
                </div>
                <div class="file-preview-head">
                  <div class="preview-popup-actions">
                    <button type="button" id="preview-popup-reset" class="ghost mini">위치 초기화</button>
                    <button type="button" id="preview-popup-maximize" class="ghost mini">최대화</button>
                    <button type="button" id="preview-popup-close" class="ghost mini">닫기</button>
                  </div>
                  <label class="file-preview-size">
                    <span>View</span>
                    <select id="file-preview-size">
                      <option value="compact">Compact</option>
                      <option value="fit" selected>Fit</option>
                      <option value="expanded">Expanded</option>
                    </select>
                  </label>
                  <span id="file-preview-path">No file selected</span>
                  <span id="file-preview-status" class="file-preview-status"></span>
                </div>
              </div>
              <div class="file-preview-body">
                <textarea
                  id="file-preview-editor"
                  class="file-preview-editor"
                  rows="10"
                  placeholder="Select a text file to preview."
                ></textarea>
                <div id="file-preview-markdown" class="file-preview-markdown"></div>
                <img id="file-preview-image" class="file-preview-image" alt="" />
                <iframe id="file-preview-frame" class="file-preview-frame" title="File preview"></iframe>
              </div>
              <input
                id="file-preview-saveas-path"
                class="ghost-input"
                placeholder="Save as path (e.g., report_notes/notes.md)"
              />
              <div class="file-preview-actions">
                <button type="button" id="file-preview-open" class="ghost">
                  Open
                </button>
                <button type="button" id="file-preview-canvas" class="ghost">
                  Canvas
                </button>
                <button type="button" id="file-preview-save" class="ghost">
                  Save
                </button>
                <button type="button" id="file-preview-saveas" class="ghost">
                  Download
                </button>
                <button type="button" id="file-preview-export-pdf" class="ghost">
                  PDF 내보내기
                </button>
              </div>
            </section>
          </div>
        </section>
      </main>

      <section class="workspace-panel" id="workspace-panel" aria-hidden="true">
        <div class="workspace-panel-head">
          <div>
            <h2>Federnett Workspace Settings</h2>
            <p>Templates, Agent Profiles, Agent Capabilities를 한 패널에서 제어합니다.</p>
          </div>
          <div class="workspace-panel-actions">
            <button type="button" id="workspace-close" class="ghost">Close</button>
          </div>
        </div>
        <div class="workspace-tab-row" role="tablist" aria-label="Workspace tabs">
          <button
            type="button"
            class="workspace-tab active"
            id="workspace-tab-templates"
            data-workspace-tab="templates"
            aria-selected="true"
          >
            Templates
          </button>
          <button
            type="button"
            class="workspace-tab"
            id="workspace-tab-agents"
            data-workspace-tab="agents"
            aria-selected="false"
          >
            Agent Profiles
          </button>
          <button
            type="button"
            class="workspace-tab"
            id="workspace-tab-capabilities"
            data-workspace-tab="capabilities"
            aria-selected="false"
          >
            Agent Capabilities
          </button>
        </div>
        <div class="workspace-pane active" id="workspace-pane-templates" data-workspace-pane="templates">
      <section class="panel templates-panel" id="templates-panel">
        <div class="panel-head slim">
          <div>
            <h2>Templates</h2>
            <p>Template sections + guidance parsed from frontmatter.</p>
          </div>
          <div class="panel-pills">
            <button type="button" class="ghost" id="templates-panel-toggle">Hide panel</button>
            <button type="button" class="ghost" id="templates-toggle">Hide cards</button>
          </div>
        </div>
        <div id="templates-grid" class="templates-grid"></div>
        <div class="template-editor" id="template-editor">
          <div class="template-editor-head">
            <div>
              <h3>Custom Template</h3>
              <p>Create or adjust a template, then save it under <code>src/federlicht/templates</code>.</p>
            </div>
            <div class="template-editor-actions">
              <button type="button" class="ghost" id="template-editor-load">Load Base</button>
              <button type="button" class="primary" id="template-editor-save">Save Template</button>
            </div>
          </div>
          <div class="template-editor-controls">
            <label>
              Base template
              <select id="template-editor-base"></select>
            </label>
            <label>
              Save as
              <input
                id="template-editor-name"
                class="ghost-input"
                placeholder="custom_my_template"
              />
            </label>
            <label>
              Save path
              <input
                id="template-editor-path"
                class="ghost-input"
                placeholder="site/custom_templates/custom_my_template.md"
                disabled
              />
            </label>
          </div>
          <div class="template-builder" id="template-builder">
            <div class="template-builder-row">
              <label>
                CSS style
                <select id="template-style-select"></select>
              </label>
              <div class="template-builder-actions">
                <button type="button" id="template-preview-refresh" class="ghost">Refresh Preview</button>
                <button type="button" id="template-apply-frontmatter" class="ghost">Apply to Editor</button>
              </div>
            </div>
            <div class="template-generator">
              <label>
                Generate base prompt
                <textarea
                  id="template-gen-prompt"
                  class="ghost-input"
                  placeholder="예: 월간 매거진 스타일의 기술동향 보고서 템플릿을 만들어줘..."
                ></textarea>
              </label>
              <div class="template-generator-row">
                <label>
                  Model
                  <input id="template-gen-model" list="model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label class="template-inline-check">
                  <input type="checkbox" id="template-store-site" />
                  Store in site (shared)
                </label>
                <button type="button" id="template-generate" class="primary">Generate Base</button>
              </div>
              <pre id="template-gen-log" class="template-gen-log">Ready.</pre>
            </div>
            <div class="template-builder-grid">
              <div class="template-sections-editor">
                <div class="template-section-head">
                  <h4>Sections</h4>
                  <button type="button" id="template-section-add" class="ghost">Add Section</button>
                </div>
                <div id="template-sections-list" class="template-sections-list"></div>
              </div>
              <div class="template-guidance-editor">
                <label>
                  Writer guidance (one per line)
                  <textarea
                    id="template-writer-guidance"
                    class="ghost-input template-writer-guidance"
                    placeholder="Use clear terminology and define acronyms."
                  ></textarea>
                </label>
              </div>
            </div>
            <div class="template-preview">
              <div class="template-preview-head">
                <h4>Preview</h4>
                <span class="muted">Uses the selected CSS and section order.</span>
              </div>
              <iframe id="template-preview-frame" class="template-preview-frame" title="Template preview"></iframe>
            </div>
          </div>
          <textarea
            id="template-editor-body"
            class="ghost-input template-editor-body"
            placeholder="Paste or edit template markdown here..."
          ></textarea>
          <div class="template-editor-meta" id="template-editor-meta"></div>
        </div>
      </section>
        </div>
        <div class="workspace-pane" id="workspace-pane-agents" data-workspace-pane="agents">
      <section class="panel agent-panel" id="agent-panel">
        <div class="panel-head slim">
          <div>
            <h2>Agent Profiles</h2>
            <p>Manage persona prompts, memory hooks, and profile-level Federlicht/agent overrides.</p>
          </div>
          <div class="panel-pills">
            <button type="button" class="ghost" id="agent-panel-toggle">Hide panel</button>
          </div>
        </div>
        <div class="agent-grid">
          <div class="agent-list">
            <div class="agent-list-head">
              <h3>Profiles</h3>
              <button type="button" id="agent-new" class="ghost">New</button>
            </div>
            <div id="agent-list" class="agent-list-items"></div>
          </div>
          <div class="agent-editor">
            <div class="agent-editor-head">
              <div>
                <h3 id="agent-editor-title">Profile</h3>
                <p id="agent-editor-meta" class="muted">Select a profile to edit.</p>
              </div>
              <div class="agent-editor-actions">
                <button type="button" id="agent-root-auth" class="ghost">Root Unlock</button>
                <button type="button" id="agent-session-auth" class="ghost">Sign In</button>
                <button type="button" id="agent-clone" class="ghost">Clone</button>
                <button type="button" id="agent-save" class="primary">Save</button>
                <button type="button" id="agent-delete" class="danger">Delete</button>
              </div>
            </div>
            <div id="agent-readonly-hint" class="agent-readonly-hint"></div>
            <div id="agent-session-status" class="agent-session-status muted">Session auth: disabled</div>
            <div class="agent-editor-grid">
              <label>
                Profile ID
                <input id="agent-id" class="ghost-input" placeholder="federhav" />
              </label>
              <label>
                Agent name
                <input id="agent-name" class="ghost-input" placeholder="FederHav" />
              </label>
              <label>
                Author name
                <input id="agent-author-name" class="ghost-input" placeholder="Report byline author name" />
              </label>
              <label>
                Organization (optional)
                <input id="agent-organization" class="ghost-input" placeholder="Team or organization label" />
              </label>
              <label>
                Tagline
                <input
                  id="agent-tagline"
                  class="ghost-input"
                  placeholder="Havruta-inspired Knowledge Resonance AI"
                />
              </label>
              <label>
                Apply to
                <div id="agent-apply-to-checks" class="agent-apply-checks"></div>
              </label>
              <label>
                Apply to (custom, optional)
                <input
                  id="agent-apply-to-custom"
                  class="ghost-input"
                  placeholder="comma-separated optional targets"
                />
              </label>
              <label>
                Memory description
                <input
                  id="agent-memory-desc"
                  class="ghost-input"
                  placeholder="Stable editorial values, interests, style preferences."
                />
              </label>
              <label>
                Memory file
                <input id="agent-memory-path" class="ghost-input" disabled />
              </label>
              <label class="agent-inline-check">
                <input type="checkbox" id="agent-store-site" />
                Store in site (shared)
              </label>
            </div>
            <label>
              System prompt
              <textarea
                id="agent-system-prompt"
                class="ghost-input"
                rows="6"
                placeholder="Describe the persona, tone, and constraints for this agent."
              ></textarea>
            </label>
            <label>
              Config overrides (JSON)
              <textarea
                id="agent-config-overrides"
                class="ghost-input"
                rows="6"
                placeholder='{"quality_iterations": 2, "quality_strategy": "pairwise", "template_rigidity": "balanced"}'
              ></textarea>
            </label>
            <label>
              Agent overrides (JSON)
              <textarea
                id="agent-agent-overrides"
                class="ghost-input"
                rows="8"
                placeholder='{"writer": {"model": "gpt-5.2"}, "critic": {"enabled": true}}'
              ></textarea>
            </label>
            <label>
              Memory hook
              <textarea
                id="agent-memory-text"
                class="ghost-input"
                rows="5"
                placeholder="Optional long-term notes, style rules, or domain anchors."
              ></textarea>
            </label>
            <pre id="agent-status" class="agent-status">Ready.</pre>
          </div>
        </div>
      </section>
        </div>
        <div class="workspace-pane" id="workspace-pane-capabilities" data-workspace-pane="capabilities">
      <section class="panel capability-studio-panel" id="capability-studio-panel">
        <div class="panel-head slim">
          <div>
            <h2>Agent Capabilities</h2>
            <p>Tool/Skill/MCP capability registry를 중앙 스튜디오에서 관리합니다.</p>
          </div>
          <div class="panel-pills">
            <button type="button" class="ghost" id="cap-studio-refresh">Refresh</button>
          </div>
        </div>
        <div class="capability-studio-grid">
          <section class="capability-studio-runtime">
            <h3>Runtime 상태</h3>
            <div id="cap-studio-runtime-grid" class="ask-capability-grid"></div>
            <h3>Capability Packs</h3>
            <div id="cap-studio-pack-detail" class="cap-studio-pack-detail"></div>
          </section>
          <section class="capability-studio-manager">
            <div class="ask-cap-manager-head">
              <strong>Capability Registry</strong>
              <span class="muted">keywords + action(kind/target) 바인딩으로 동작 경로를 정의합니다.</span>
            </div>
            <div class="ask-cap-manager-form">
              <label>
                Type
                <select id="cap-studio-kind">
                  <option value="tool">Tool</option>
                  <option value="skill">Skill</option>
                  <option value="mcp">MCP</option>
                </select>
              </label>
              <label>
                ID
                <input id="cap-studio-id" class="ghost-input" placeholder="my_capability_id" />
              </label>
              <label>
                Name
                <input id="cap-studio-label" class="ghost-input" placeholder="My Capability" />
              </label>
              <label>
                Description
                <input id="cap-studio-desc" class="ghost-input" placeholder="What this capability does" />
              </label>
              <label>
                Keywords
                <input id="cap-studio-keywords" class="ghost-input" placeholder="search, summarize, report" />
              </label>
              <label>
                Action
                <select id="cap-studio-action-kind">
                  <option value="none">none (metadata only)</option>
                  <option value="open_path">open_path</option>
                  <option value="open_url">open_url</option>
                  <option value="set_inline_prompt">set_inline_prompt</option>
                  <option value="run_feather">run_feather</option>
                  <option value="run_federlicht">run_federlicht</option>
                  <option value="run_feather_then_federlicht">run_feather_then_federlicht</option>
                  <option value="mcp_ping">mcp_ping</option>
                </select>
              </label>
              <label>
                Action Target
                <input id="cap-studio-action-target" class="ghost-input" placeholder="path/url/prompt text" />
              </label>
              <label>
                Endpoint (MCP optional)
                <input id="cap-studio-endpoint" class="ghost-input" placeholder="http://localhost:8787/sse" />
              </label>
              <label class="ask-policy-check">
                <input type="checkbox" id="cap-studio-enabled" checked />
                <span>Enabled</span>
              </label>
              <button type="button" id="cap-studio-add" class="primary">추가</button>
            </div>
            <div id="cap-studio-list" class="ask-cap-manager-list"></div>
            <pre id="cap-studio-status" class="cap-studio-status">Ready.</pre>
          </section>
        </div>
      </section>
        </div>
      </section>

      <div class="modal" id="instruction-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Instruction Files</h3>
              <p>Select an existing file or create a new one for Feather or Prompt.</p>
            </div>
            <button type="button" class="ghost" data-modal-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              id="instruction-search"
              class="ghost-input"
              placeholder="Filter by filename or path"
            />
            <label class="file-import">
              Import File
              <input id="instruction-import" type="file" accept=".txt,.md" />
            </label>
          </div>
          <div id="instruction-list" class="modal-list"></div>
          <div class="modal-footer">
            <input
              id="instruction-saveas"
              class="ghost-input"
              placeholder="instruction/new_topic.txt"
            />
            <div class="actions">
              <button type="button" id="instruction-use-selected" class="ghost">
                Use Selected
              </button>
              <button type="button" id="instruction-saveas-btn" class="primary">
                Save As
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="run-picker-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-runpicker-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Choose Run Folder</h3>
              <p>Select a run under the configured run root.</p>
            </div>
            <button type="button" class="ghost" data-runpicker-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              id="run-picker-search"
              class="ghost-input"
              placeholder="Filter runs"
            />
            <label class="run-picker-root-field">
              <span>Run Root</span>
              <select id="run-picker-root"></select>
            </label>
            <button type="button" id="run-picker-reload" class="ghost mini">Reload Runs</button>
          </div>
          <details class="run-picker-workspace-settings">
            <summary>Workspace Root Settings (root)</summary>
            <div class="advanced-grid">
              <label class="wide">
                <span>Run Roots (comma separated)</span>
                <input id="workspace-run-roots" class="ghost-input" placeholder="site/runs,runs" />
              </label>
              <label class="wide">
                <span>Add Run Root</span>
                <div class="combo">
                  <input id="workspace-run-root-add" class="ghost-input" placeholder="custom/runs_root" />
                  <button type="button" id="workspace-run-root-add-btn" class="ghost">Add Root</button>
                </div>
              </label>
              <label>
                <span>Site Root</span>
                <input id="workspace-site-root" class="ghost-input" placeholder="site" />
              </label>
              <label>
                <span>Report Hub Root</span>
                <input id="workspace-report-hub-root" class="ghost-input" placeholder="site/report_hub" />
              </label>
            </div>
            <div class="actions">
              <button type="button" id="workspace-settings-reload" class="ghost">Reload Settings</button>
              <button type="button" id="workspace-settings-save" class="ghost">Save Settings</button>
            </div>
            <small id="workspace-settings-status" class="muted">workspace settings: not loaded</small>
          </details>
          <div id="run-picker-list" class="modal-list"></div>
          <div class="modal-footer run-picker-footer">
              <div class="run-picker-create">
              <input id="run-picker-create-name" class="ghost-input" placeholder="new_run_name (no spaces)" />
              <button type="button" id="run-picker-create" class="ghost">Create</button>
            </div>
            <div class="actions">
              <button type="button" id="run-picker-open" class="ghost">Open Selected</button>
              <button type="button" id="run-picker-use" class="primary">Load Selected</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="model-policy-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-modelpolicy-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>LLM Settings</h3>
              <p>Global 정책과 Feather/Federlicht/FederHav 스코프별 오버라이드를 한 곳에서 관리합니다.</p>
            </div>
            <button type="button" class="ghost" data-modelpolicy-close>Close</button>
          </header>
          <div class="modal-list model-policy-list">
            <section class="workflow-studio-section">
              <h4>Global Baseline</h4>
              <div class="advanced-grid">
                <label>
                  <span>LLM Backend</span>
                  <select id="global-llm-backend">
                    <option value="openai_api" selected>OpenAI API</option>
                    <option value="codex_cli">Codex CLI Auth</option>
                  </select>
                </label>
                <label>
                  <span>Model</span>
                  <input id="global-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label>
                  <span>Check Model</span>
                  <input id="global-check-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label>
                  <span>Vision Model</span>
                  <input id="global-vision-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label>
                  <span>Reasoning Effort</span>
                  <select id="global-reasoning-effort">
                    <option value="off" selected>off</option>
                    <option value="low">low</option>
                    <option value="medium">medium</option>
                    <option value="high">high</option>
                    <option value="extra_high">extra_high</option>
                  </select>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="global-model-lock" checked />
                  <span>Global Sync Lock</span>
                </label>
              </div>
              <small id="policy-global-effective" class="workflow-studio-note policy-effective-line">effective: -</small>
            </section>

            <section class="workflow-studio-section">
              <h4>Feather Policy</h4>
              <div class="advanced-grid">
                <label>
                  <span>Policy Mode</span>
                  <select id="policy-feather-mode">
                    <option value="inherit" selected>Inherit Global</option>
                    <option value="custom">Custom</option>
                  </select>
                </label>
                <label>
                  <span>LLM Backend</span>
                  <select id="policy-feather-backend">
                    <option value="openai_api" selected>OpenAI API</option>
                    <option value="codex_cli">Codex CLI Auth</option>
                  </select>
                </label>
                <label class="wide">
                  <span>Agentic Model</span>
                  <input id="policy-feather-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
              </div>
              <small id="policy-feather-hint" class="workflow-studio-note">Inherit: Global LLM Settings를 그대로 사용합니다.</small>
              <small id="policy-feather-effective" class="workflow-studio-note policy-effective-line">effective: -</small>
            </section>

            <section class="workflow-studio-section">
              <h4>Federlicht Policy</h4>
              <div class="advanced-grid">
                <label>
                  <span>Policy Mode</span>
                  <select id="policy-federlicht-mode">
                    <option value="inherit">Inherit Global</option>
                    <option value="custom" selected>Custom</option>
                  </select>
                </label>
                <label>
                  <span>LLM Backend</span>
                  <select id="policy-federlicht-backend">
                    <option value="openai_api" selected>OpenAI API</option>
                    <option value="codex_cli">Codex CLI Auth</option>
                  </select>
                </label>
                <label>
                  <span>Model</span>
                  <input id="policy-federlicht-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label>
                  <span>Check Model</span>
                  <input id="policy-federlicht-check-model" list="openai-model-options" placeholder="$OPENAI_MODEL" />
                </label>
                <label>
                  <span>Vision Model</span>
                  <input id="policy-federlicht-vision-model" list="openai-model-options" placeholder="$OPENAI_MODEL_VISION" />
                </label>
                <label>
                  <span>Reasoning Effort</span>
                  <select id="policy-federlicht-reasoning-effort">
                    <option value="off" selected>off</option>
                    <option value="low">low</option>
                    <option value="medium">medium</option>
                    <option value="high">high</option>
                    <option value="extra_high">extra_high</option>
                  </select>
                </label>
              </div>
              <small id="policy-federlicht-hint" class="workflow-studio-note">Custom: Federlicht는 OPENAI_MODEL/OPENAI_MODEL_VISION 기본값을 우선 사용합니다.</small>
              <small id="policy-federlicht-effective" class="workflow-studio-note policy-effective-line">effective: -</small>
            </section>

            <section class="workflow-studio-section">
              <h4>FederHav Policy</h4>
              <div class="advanced-grid">
                <label>
                  <span>Policy Mode</span>
                  <select id="policy-federhav-mode">
                    <option value="inherit">Inherit Global</option>
                    <option value="custom" selected>Custom</option>
                  </select>
                </label>
                <label>
                  <span>LLM Backend</span>
                  <select id="policy-federhav-backend">
                    <option value="openai_api" selected>OpenAI API</option>
                    <option value="codex_cli">Codex CLI Auth</option>
                  </select>
                </label>
                <label>
                  <span>Model</span>
                  <input id="policy-federhav-model" list="openai-model-options" placeholder="gpt-4o-mini" />
                </label>
                <label>
                  <span>Reasoning Effort</span>
                  <select id="policy-federhav-reasoning-effort">
                    <option value="off" selected>off</option>
                    <option value="low">low</option>
                    <option value="medium">medium</option>
                    <option value="high">high</option>
                    <option value="extra_high">extra_high</option>
                  </select>
                </label>
                <label>
                  <span>Runtime Mode</span>
                  <select id="policy-federhav-runtime-mode">
                    <option value="auto" selected>auto</option>
                    <option value="deepagent">deepagent</option>
                    <option value="off">off</option>
                  </select>
                </label>
                <label>
                  <span>Log Context</span>
                  <select id="policy-federhav-live-log-tail-size">
                    <option value="1200">1.2k</option>
                    <option value="2200" selected>2.2k</option>
                    <option value="3600">3.6k</option>
                    <option value="5200">5.2k</option>
                  </select>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="policy-federhav-live-auto-log" checked />
                  <span>FederHav Auto Log Context</span>
                </label>
              </div>
              <small id="policy-federhav-hint" class="workflow-studio-note">Custom: FederHav 기본 모델은 gpt-4o-mini입니다.</small>
              <small id="policy-federhav-effective" class="workflow-studio-note policy-effective-line">effective: -</small>
            </section>

            <section class="workflow-studio-section">
              <h4>Federlicht Stage Overrides</h4>
              <p class="workflow-studio-note">
                Stage override 편집은 LLM Settings에서만 제공합니다. 저장 시 run의 <code>workflow_stage_overrides.json</code>으로 동기화됩니다.
              </p>
              <div class="workflow-stage-select-wrap">
                <label class="wide">
                  <span>설정 대상 Stage</span>
                  <select id="wf-stage-select" aria-label="Workflow stage override target"></select>
                  <small class="workflow-studio-field-help">선택 stage 1개에만 override를 적용합니다.</small>
                </label>
                <div class="workflow-stage-badges">
                  <span id="wf-selected-stage-pill" class="workflow-stage-badge is-selected">selected: -</span>
                  <span id="wf-active-stage-pill" class="workflow-stage-badge">pipeline focus: -</span>
                </div>
                <div class="workflow-stage-actions">
                  <button type="button" id="wf-stage-focus-active" class="ghost mini">활성 Stage로 맞춤</button>
                  <button type="button" id="wf-stage-reset" class="ghost mini">선택 Stage 초기화</button>
                </div>
                <div id="wf-stage-context" class="workflow-stage-context">선택된 stage 정보를 불러오는 중...</div>
              </div>
              <div class="workflow-studio-grid">
                <label>
                  <span>Tool Mapping (쉼표 구분)</span>
                  <input id="wf-stage-tools" list="wf-stage-tool-suggestions" placeholder="예: list_archive_files,read_document,web_search" />
                  <small class="workflow-studio-field-help">비우면 프로필/런타임 기본 도구를 사용합니다.</small>
                </label>
                <label class="wide">
                  <span>System Prompt Override (선택)</span>
                  <textarea id="wf-stage-prompt" rows="4" placeholder="선택한 stage의 system prompt를 덮어씁니다."></textarea>
                  <small class="workflow-studio-field-help">실험 목적일 때만 권장됩니다. 기본 Prompt 일관성이 먼저입니다.</small>
                </label>
              </div>
              <details class="workflow-stage-policy" open>
                <summary>Prompt Override 적용 방식</summary>
                <pre id="wf-stage-prompt-preview">선택한 stage의 prompt 구조를 불러오는 중...</pre>
              </details>
              <small id="wf-stage-tools-known" class="workflow-studio-note">사용 가능 도구: 런타임/프로필 설정을 반영해 표시됩니다.</small>
              <small class="workflow-studio-note">override 우선순위: Global LLM Settings → Stage Override → Runtime Temporary</small>
              <div id="wf-stage-tool-help" class="workflow-studio-tool-help"></div>
              <datalist id="wf-stage-tool-suggestions">
                <option value="list_archive_files"></option>
                <option value="list_supporting_files"></option>
                <option value="read_document"></option>
                <option value="web_search"></option>
                <option value="search_web"></option>
                <option value="source_index"></option>
                <option value="llm_generate"></option>
              </datalist>
              <div class="workflow-studio-toggles">
                <label class="toggle">
                  <input type="checkbox" id="wf-stage-enabled" checked />
                  <span>이 stage 사용</span>
                </label>
              </div>
            </section>

            <small class="muted">Precedence: payload explicit value → stage override → scoped policy (custom/inherit) → global baseline → environment defaults.</small>
          </div>
          <div class="modal-footer">
            <button type="button" id="model-policy-apply" class="primary">Apply LLM Settings</button>
          </div>
        </div>
      </div>

      <div class="modal" id="jobs-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-jobs-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Recent Jobs</h3>
              <p id="jobs-modal-subtitle">Latest activity for the selected run.</p>
            </div>
            <div class="modal-controls">
              <button type="button" id="jobs-toggle" class="ghost">Show more</button>
              <button type="button" class="ghost" data-jobs-close>Close</button>
            </div>
          </header>
          <div id="jobs-modal-list" class="modal-list"></div>
        </div>
      </div>

      <div class="modal" id="template-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-modal-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3 id="template-modal-title">Template Preview</h3>
              <p id="template-modal-meta">Template details</p>
            </div>
            <button type="button" class="ghost" data-modal-close>Close</button>
          </header>
          <div id="template-modal-body" class="modal-list"></div>
        </div>
      </div>

      <div class="modal" id="saveas-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-saveas-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Save As</h3>
              <p>Select a folder, then name the file.</p>
            </div>
            <button type="button" class="ghost" data-saveas-close>Close</button>
          </header>
          <div class="modal-controls">
            <input
              type="text"
              id="saveas-path"
              class="ghost-input"
              placeholder="Current folder"
            />
            <button type="button" class="ghost" id="saveas-up">Up</button>
          </div>
          <div id="saveas-list" class="modal-list"></div>
          <div class="modal-footer">
            <input
              type="text"
              id="saveas-filename"
              class="ghost-input"
              placeholder="Filename (e.g., notes.md)"
            />
            <button type="button" class="ghost" id="saveas-confirm">Save Here</button>
          </div>
        </div>
      </div>

      <div class="modal" id="help-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-help-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3>Federnett Help</h3>
              <p>Quick guidance for Feather, Federlicht, and pipeline controls.</p>
            </div>
            <button type="button" class="ghost" data-help-close>Close</button>
          </header>
          <div class="modal-list help-body">
            <section class="help-section" id="help-feather">
              <h4>Feather</h4>
              <ul>
                <li>
                  Choose an instruction file or edit inline, then Save / Save As before
                  running.
                </li>
                <li>
                  Output folder defaults to <code>&lt;run&gt;</code> under the configured
                  run root. Run name helps auto-fill paths.
                </li>
                <li>
                  Language/days/max-results/backend/model 옵션은 기본 화면에 항상 표시됩니다.
                </li>
                <li>
                  <code>--input</code>: instruction folder or single <code>.txt</code> file.
                </li>
                <li>
                  <code>--query</code>: inline instructions (separate with <code>;</code> or newlines).
                </li>
                <li>
                  <code>--output</code>: output archive root (defaults to run root if unset).
                </li>
                <li>
                  <code>--days</code>: lookback window in days (default: 30).
                </li>
                <li>
                  <code>--max-results</code>: results per search step (default: 8).
                </li>
                <li>
                  <code>--agentic-search</code>: turn on iterative LLM-guided expansion.
                </li>
                <li>
                  <code>--model</code>: model used for agentic planning turns.
                </li>
                <li>
                  <code>--max-iter</code>: maximum agentic planning iterations (default: 3).
                </li>
                <li>
                  <code>--download-pdf</code>: fetch arXiv PDFs + extract text.
                </li>
                <li>
                  <code>--update-run</code>: reuse an existing run folder instead of creating
                  a new <code>_01</code> suffix (UI default: on).
                </li>
                <li>
                  <code>--openalex</code>/<code>--no-openalex</code>: toggle OpenAlex OA search
                  (defaults on when <code>--download-pdf</code> is set).
                </li>
                <li>
                  <code>--youtube</code>/<code>--no-youtube</code>: toggle YouTube search
                  (default: off).
                </li>
                <li>
                  <code>--lang</code>: preferred language for search results (soft preference).
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-federlicht">
              <h4>Federlicht</h4>
              <ul>
                <li>
                  Pick a run folder, template, and prompt file. The inline prompt mirrors
                  the file for quick edits.
                </li>
                <li>
                  Save Prompt writes back to the selected file; Save Prompt As creates a
                  new file and updates the field.
                </li>
                <li>
                  Run is disabled while a job is active. Stop via Live Logs if needed.
                </li>
                <li>
                  실행 옵션은 CLI 플래그(예: depth, web search, figures, quality strategy)와
                  1:1로 연결됩니다. Runtime Model Policy를 함께 보면서 조정하세요.
                </li>
                <li>
                  <code>--run</code>: run folder to synthesize.
                </li>
                <li>
                  <code>--output</code>: report output path (<code>.md</code>/<code>.html</code>/<code>.tex</code>).
                </li>
                <li>
                  <code>--template</code>: report template name/path (default: auto).
                </li>
                <li>
                  <code>--style-pack</code>: free-format HTML 스타일 프리셋 (none|dark|journal|magazine).
                </li>
                <li>
                  <code>--prompt</code>/<code>--prompt-file</code>: report focus prompt.
                </li>
                <li>
                  <code>--lang</code>: report language (default: ko).
                </li>
                <li>
                  <code>--depth</code>: brief | normal | deep | exhaustive (auto if unset).
                </li>
                <li>
                  <code>--template-rigidity</code>: strict | balanced | relaxed | loose | off (default: balanced).
                </li>
                <li>
                  <code>--temperature-level</code>: model creativity profile (default: balanced=0.2).
                </li>
                <li>
                  <code>--reasoning-effort</code>: off | low | medium | high | extra_high (추론형 모델에서만 권장).
                </li>
                <li>
                  <code>--web-search</code>: enable web research (default: off).
                </li>
                <li>
                  <code>--stages</code>/<code>--skip-stages</code>: control pipeline stages.
                </li>
                <li>
                  <code>--max-input-tokens</code>: per-agent input budget (default: unset; uses model profile).
                </li>
                <li>
                  <code>--progress-chars</code>: live log snippet length before
                  <code>[truncated]</code> is appended (default: 800).
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-options">
              <h4>Options & Limits</h4>
              <ul>
                <li>
                  <code>max-chars</code> / <code>max-pdf-pages</code> / <code>max-tool-chars</code>
                  are CLI-only safety controls (hidden in Federnett UI).
                </li>
                <li>
                  PDF follow-ups can use <code>start_page</code> to read later pages without
                  raising global limits.
                </li>
                <li>
                  NEEDS_VERIFICATION items prefer tool-cache excerpts; ensure citations
                  point to verified chunks.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-env">
              <h4>Runtime Environment</h4>
              <ul>
                <li>
                  <code>OPENAI_API_KEY</code>: required for OpenAI/OpenAI-compatible model calls.
                </li>
                <li>
                  <code>OPENAI_BASE_URL</code> (or <code>OPENAI_API_BASE</code>):
                  endpoint for OpenAI-compatible on-prem gateways.
                </li>
                <li>
                  <code>OPENAI_MODEL</code>: default model when UI model field is empty.
                </li>
                <li>
                  <code>OPENAI_MODEL_VISION</code>: default vision model for figure-aware paths.
                </li>
                <li>
                  Optional vision-specific endpoints:
                  <code>OPENAI_BASE_URL_VISION</code>, <code>OPENAI_API_KEY_VISION</code>.
                </li>
                <li>
                  For on-prem deployments, ensure model context limits are aligned with
                  Federnett/Federlicht <code>max-input-tokens</code> and quality settings.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-pipeline">
              <h4>Workflow Pipeline</h4>
              <ul>
                <li>
                  Click stage chips in Live Logs to include/exclude stages, and drag to reorder.
                  선택 상태는 실행 시 CLI stage 인자로 자동 반영됩니다.
                </li>
                <li>
                  <code>Quality</code> stage controls whether quality agents run at all.
                  <code>xN</code> 배지를 클릭해 드롭다운에서 반복 횟수(1~10)를 선택할 수 있습니다.
                  Quality를 끄면 반복 루프도 함께 비활성화됩니다.
                </li>
                <li>
                  The <code>↺</code> marker beside Quality indicates feedback loop-back from
                  quality checks toward final writing passes.
                </li>
                <li>
                  <code>Resume from stage</code>는 History checkpoint를 기준으로 해당 단계부터
                  재실행 프리셋을 자동으로 구성해 줍니다.
                </li>
                <li>
                  <code>Draft update prompt</code>는 <code>report_notes/update_request_*.txt</code>를
                  생성하고, 내용을 Inline Prompt에 바로 로드합니다. 생성 직후 File Preview에서
                  파일을 바로 열어 수정할 수 있습니다.
                </li>
                <li>
                  이 Workflow는 멀티에이전트 오케스트레이션 뷰입니다. 각 stage는 역할별 agent 실행 단위를
                  의미하고, 순서/활성화를 통해 비용과 품질의 균형을 조절합니다.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-agent-capability">
              <h4>Agent Tools / Skills / MCP</h4>
              <ul>
                <li>
                  권장 용어는 <strong>Capability Packs(역량팩)</strong>입니다. Tool/Skill/MCP를
                  분리 표시하되, 운영/거버넌스는 패키지 단위로 관리합니다.
                </li>
                <li>
                  Ask 패널의 <strong>Agent 도구/스킬/MCP</strong> 칩은 현재 답변에서 사용 가능한 구성과
                  실행 상태를 보여줍니다.
                </li>
                <li>
                  <code>Source Index</code>, <code>Web Search</code>, <code>LLM Generate</code>는
                  tool 실행 상태(<em>running/done/error</em>)를 실시간으로 표시합니다.
                </li>
                <li>
                  Skills는 안전 실행 제안(Action Runner) 같은 워크플로우 기능이며, MCP는
                  등록된 서버가 있을 때만 표시됩니다.
                </li>
                <li>
                  커스텀 Capability Registry는 <code>site/agent_profiles/capability_registry.json</code>에
                  저장됩니다. Ask 패널의 <code>관리</code>에서 Tool/Skill/MCP 메타를 추가/삭제할 수 있습니다.
                </li>
                <li>
                  커스텀 capability는 <code>keywords + action(kind/target)</code>를 설정하면,
                  질문 문맥에서 자동 제안되어 실행 버튼으로 연결됩니다.
                </li>
                <li>
                  Ask 패널에는 Ask 기본 도구뿐 아니라 Federlicht 내부 runtime 도구,
                  deepagents 라우팅/실행 경로도 함께 노출됩니다.
                </li>
                <li>
                  운영 정책 로드맵은 <code>docs/capability_governance_plan.md</code>를 참고하세요.
                </li>
              </ul>
            </section>
            <section class="help-section" id="help-preview">
              <h4>File Preview</h4>
              <ul>
                <li>
                  Click a file in Run Studio to preview. Use Open to launch in a new tab,
                  Save / Download / PDF Export for editable text.
                </li>
              </ul>
            </section>
          </div>
        </div>
      </div>

      <div class="modal" id="ask-action-modal" aria-hidden="true" role="dialog">
        <div class="modal-backdrop" data-askaction-close></div>
        <div class="modal-card" role="document">
          <header class="modal-header">
            <div>
              <h3 id="ask-action-title">Action Preview</h3>
              <p id="ask-action-meta">실행 전에 파라미터를 확인하세요.</p>
            </div>
            <button type="button" class="ghost" data-askaction-close>Close</button>
          </header>
          <div class="modal-list">
            <pre id="ask-action-preview" class="agent-status">Ready.</pre>
            <section id="ask-action-run-target-box" class="ask-action-run-target-box is-hidden">
              <strong>실행 대상 Run 확정</strong>
              <label for="ask-action-run-target">
                <span>Target Run</span>
                <input
                  id="ask-action-run-target"
                  list="ask-action-run-target-options"
                  placeholder="예: test_my_run"
                  autocomplete="off"
                />
              </label>
              <small class="muted">Run 이름은 공백 없이 입력합니다. 공백은 자동으로 <code>_</code>로 변환됩니다.</small>
              <div class="ask-action-run-quick">
                <button type="button" id="ask-action-use-suggested-run" class="ghost mini is-hidden">
                  제안 run 사용
                </button>
                <button type="button" id="ask-action-use-current-run" class="ghost mini">
                  현재 선택 run 사용
                </button>
                <button type="button" id="ask-action-clear-run-target" class="ghost mini">
                  입력 지우기
                </button>
              </div>
              <small id="ask-action-run-target-context" class="muted"></small>
              <datalist id="ask-action-run-target-options"></datalist>
              <label class="ask-policy-check ask-action-create-policy" id="ask-action-run-create-wrap">
                <input type="checkbox" id="ask-action-run-create" />
                <span>Run이 없으면 생성</span>
              </label>
              <label class="ask-policy-check ask-action-run-target-confirm-wrap" id="ask-action-run-target-confirm-wrap">
                <input type="checkbox" id="ask-action-run-target-confirm" />
                <span id="ask-action-run-target-confirm-label">실행 대상을 확인했습니다.</span>
              </label>
              <small id="ask-action-run-target-note" class="muted"></small>
            </section>
            <section
              id="ask-action-instruction-confirm-box"
              class="ask-action-instruction-confirm-box is-hidden"
              aria-hidden="true"
            >
              <strong>Instruction 확인</strong>
              <small id="ask-action-instruction-confirm-context" class="muted"></small>
              <label class="ask-policy-check ask-action-instruction-confirm-wrap" id="ask-action-instruction-confirm-wrap">
                <input type="checkbox" id="ask-action-instruction-confirm" />
                <span id="ask-action-instruction-confirm-label">Instruction 초안을 확인했습니다.</span>
              </label>
              <small id="ask-action-instruction-confirm-note" class="muted"></small>
            </section>
          </div>
          <div class="modal-footer">
            <button type="button" id="ask-action-confirm" class="primary">확인 후 실행</button>
            <button type="button" class="ghost" data-askaction-close>취소</button>
          </div>
        </div>
      </div>

      <footer class="footnote">
        <div>Federnett orchestrates Feather and Federlicht CLIs via subprocess (non-invasive integration).</div>
        <div>Copyright (c) 2026 Hyun-Jung Kim. Federlicht Studio.</div>
      </footer>
    </div>

    <datalist id="model-options"></datalist>
    <datalist id="openai-model-options"></datalist>
    <datalist id="codex-model-options"></datalist>
    <script src="./app.js?v=20260222_uiux_v50" type="module"></script>
  </body>
</html>
